<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>q: SELECT的执行过程? | 程序员加文</title>
    <meta name="generator" content="VuePress 1.9.10">
    <link rel="icon" href="favicon.ico">
    <meta name="description" content="程序员加文的Java技术学习分享网站">
    
    <link rel="preload" href="/cs/assets/css/0.styles.3da77e5f.css" as="style"><link rel="preload" href="/cs/assets/js/app.3833f9ea.js" as="script"><link rel="preload" href="/cs/assets/js/2.3dc1b8de.js" as="script"><link rel="preload" href="/cs/assets/js/1.54be531d.js" as="script"><link rel="preload" href="/cs/assets/js/36.f36ea129.js" as="script"><link rel="prefetch" href="/cs/assets/js/10.563984b0.js"><link rel="prefetch" href="/cs/assets/js/11.c389195a.js"><link rel="prefetch" href="/cs/assets/js/12.81539b0f.js"><link rel="prefetch" href="/cs/assets/js/13.21c635b9.js"><link rel="prefetch" href="/cs/assets/js/14.37ef2a72.js"><link rel="prefetch" href="/cs/assets/js/15.5542c093.js"><link rel="prefetch" href="/cs/assets/js/16.d48fd1ce.js"><link rel="prefetch" href="/cs/assets/js/17.bd8d538c.js"><link rel="prefetch" href="/cs/assets/js/18.6d3b94c1.js"><link rel="prefetch" href="/cs/assets/js/19.eb35cfee.js"><link rel="prefetch" href="/cs/assets/js/20.7d8a0e52.js"><link rel="prefetch" href="/cs/assets/js/21.db1b5d88.js"><link rel="prefetch" href="/cs/assets/js/22.7b484c1b.js"><link rel="prefetch" href="/cs/assets/js/23.37dd5e12.js"><link rel="prefetch" href="/cs/assets/js/24.b0fcefbf.js"><link rel="prefetch" href="/cs/assets/js/25.39c9b679.js"><link rel="prefetch" href="/cs/assets/js/26.ac34285f.js"><link rel="prefetch" href="/cs/assets/js/27.b46debc5.js"><link rel="prefetch" href="/cs/assets/js/28.b85af783.js"><link rel="prefetch" href="/cs/assets/js/29.4ef018b1.js"><link rel="prefetch" href="/cs/assets/js/3.5322f14a.js"><link rel="prefetch" href="/cs/assets/js/30.993eb757.js"><link rel="prefetch" href="/cs/assets/js/31.531d8767.js"><link rel="prefetch" href="/cs/assets/js/32.89255c8b.js"><link rel="prefetch" href="/cs/assets/js/33.b8f4cef1.js"><link rel="prefetch" href="/cs/assets/js/34.263694d3.js"><link rel="prefetch" href="/cs/assets/js/35.6cc43691.js"><link rel="prefetch" href="/cs/assets/js/37.e7d013d3.js"><link rel="prefetch" href="/cs/assets/js/38.2836e84c.js"><link rel="prefetch" href="/cs/assets/js/4.84e1e480.js"><link rel="prefetch" href="/cs/assets/js/5.f0541060.js"><link rel="prefetch" href="/cs/assets/js/6.dfb06aa0.js"><link rel="prefetch" href="/cs/assets/js/7.7551a9fb.js"><link rel="prefetch" href="/cs/assets/js/vendors~docsearch.5e19b665.js">
    <link rel="stylesheet" href="/cs/assets/css/0.styles.3da77e5f.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/cs/" class="home-link router-link-active"><img src="/cs/logo.png" alt="程序员加文" class="logo"> <span class="site-name can-hide">程序员加文</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/cs/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="计算机基础" class="dropdown-title"><span class="title">计算机基础</span> <span class="arrow down"></span></button> <button type="button" aria-label="计算机基础" class="mobile-dropdown-title"><span class="title">计算机基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          数据库
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/cs/计算机基础/数据库/面试题/基础/数据库.html" class="nav-link">
  面试题
</a></li></ul></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/cs/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="计算机基础" class="dropdown-title"><span class="title">计算机基础</span> <span class="arrow down"></span></button> <button type="button" aria-label="计算机基础" class="mobile-dropdown-title"><span class="title">计算机基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          数据库
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/cs/计算机基础/数据库/面试题/基础/数据库.html" class="nav-link">
  面试题
</a></li></ul></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>基础</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>逻辑架构</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/cs/计算机基础/数据库/面试题/逻辑架构/逻辑架构.html" class="active sidebar-link">逻辑架构</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cs/计算机基础/数据库/面试题/逻辑架构/逻辑架构.html#q-mysql都有哪些引擎" class="sidebar-link">q: MySQL都有哪些引擎？</a></li><li class="sidebar-sub-header"><a href="/cs/计算机基础/数据库/面试题/逻辑架构/逻辑架构.html#q-innodb存储引擎的特点" class="sidebar-link">q: innodb存储引擎的特点</a></li></ul></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>索引</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>事务</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h3 id="q-select的执行过程"><a href="#q-select的执行过程" class="header-anchor">#</a> q: SELECT的执行过程?</h3> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">#方式1：</span>
<span class="token keyword">SELECT</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">FROM</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">WHERE</span> 多表的连接条件
<span class="token operator">AND</span> 不包含组函数的过滤条件
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">HAVING</span> 包含组函数的过滤条件
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token keyword">ASC</span><span class="token operator">/</span><span class="token keyword">DESC</span>
<span class="token keyword">LIMIT</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token comment">#方式2：</span>
<span class="token keyword">SELECT</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">FROM</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token keyword">JOIN</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">ON</span> 多表的连接条件
<span class="token keyword">JOIN</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">ON</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">WHERE</span> 不包含组函数的过滤条件
<span class="token operator">AND</span><span class="token operator">/</span><span class="token operator">OR</span> 不包含组函数的过滤条件
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">HAVING</span> 包含组函数的过滤条件
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token keyword">ASC</span><span class="token operator">/</span><span class="token keyword">DESC</span>
<span class="token keyword">LIMIT</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token comment">#其中：</span>
<span class="token comment">#（1）from：从哪些表中筛选</span>
<span class="token comment">#（2）on：关联多表查询时，去除笛卡尔积</span>
<span class="token comment">#（3）where：从表中筛选的条件</span>
<span class="token comment">#（4）group by：分组依据</span>
<span class="token comment">#（5）having：在统计结果中再次筛选</span>
<span class="token comment">#（6）order by：排序</span>
<span class="token comment">#（7）limit：分页</span>
</code></pre></div><p><img src="https://obs-knowledge.oss-cn-beijing.aliyuncs.com/img/20230623225352.png" alt="image.png"></p> <p>SELECT执行顺序</p> <p>需要记住 SELECT 查询时的两个顺序：</p> <ol><li>关键字的顺序是不能颠倒的：</li></ol> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token keyword">FROM</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token keyword">WHERE</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token keyword">HAVING</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token keyword">LIMIT</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
</code></pre></div><ol start="2"><li>SELECT 语句的执行顺序（在 MySQL 和 Oracle 中，SELECT 执行顺序基本相同）：</li></ol> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">FROM</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token keyword">WHERE</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token keyword">HAVING</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token keyword">SELECT</span> 的字段 <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token keyword">DISTINCT</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token keyword">LIMIT</span>
</code></pre></div><p><img src="https://obs-knowledge.oss-cn-beijing.aliyuncs.com/img/20231027140708.png" alt="image.png"></p> <p>比如写了一个 SQL 语句，那么它的关键字顺序和执行顺序是下面这样的：</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token keyword">DISTINCT</span> player_id<span class="token punctuation">,</span> player_name<span class="token punctuation">,</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">as</span> num <span class="token comment"># 顺序 5</span>
<span class="token keyword">FROM</span> player <span class="token keyword">JOIN</span> team <span class="token keyword">ON</span> player<span class="token punctuation">.</span>team_id <span class="token operator">=</span> team<span class="token punctuation">.</span>team_id <span class="token comment"># 顺序 1</span>
<span class="token keyword">WHERE</span> height <span class="token operator">&gt;</span> <span class="token number">1.80</span> <span class="token comment"># 顺序 2</span>
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> player<span class="token punctuation">.</span>team_id <span class="token comment"># 顺序 3</span>
<span class="token keyword">HAVING</span> num <span class="token operator">&gt;</span> <span class="token number">2</span> <span class="token comment"># 顺序 4</span>
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> num <span class="token keyword">DESC</span> <span class="token comment"># 顺序 6</span>
<span class="token keyword">LIMIT</span> <span class="token number">2</span> <span class="token comment"># 顺序 7</span>
</code></pre></div><p>在 SELECT 语句执行这些步骤的时候，每个步骤都会产生一个 虚拟表 ，然后将这个虚拟表传入下一个步骤中作为输入。需要注意的是，这些步骤隐含在 SQL 的执行过程中，对于我们来说是不可见的。</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">#4. SQL底层执行原理</span>
<span class="token comment">#4.1 SELECT 语句的完整结构</span>
<span class="token comment">/*
#sql92语法：
SELECT ....,....,....(存在聚合函数)
FROM ...,....,....
WHERE 多表的连接条件 AND 不包含聚合函数的过滤条件
GROUP BY ...,....
HAVING 包含聚合函数的过滤条件
ORDER BY ....,...(ASC / DESC )
LIMIT ...,....


#sql99语法：
SELECT ....,....,....(存在聚合函数)
FROM ... (LEFT / RIGHT)JOIN ....ON 多表的连接条件 
(LEFT / RIGHT)JOIN ... ON ....
WHERE 不包含聚合函数的过滤条件
GROUP BY ...,....
HAVING 包含聚合函数的过滤条件
ORDER BY ....,...(ASC / DESC )
LIMIT ...,....
*/</span>

<span class="token comment">#4.2 SQL语句的执行过程：</span>
<span class="token comment">#FROM ...,...-&gt; ON -&gt; (LEFT/RIGNT  JOIN) -&gt; WHERE -&gt; GROUP BY -&gt; HAVING -&gt; SELECT -&gt; DISTINCT -&gt; </span>
<span class="token comment"># ORDER BY -&gt; LIMIT</span>
</code></pre></div><h3 id="q-sql-语句交给mysql执行的过程"><a href="#q-sql-语句交给mysql执行的过程" class="header-anchor">#</a> q: sql 语句交给mysql执行的过程？</h3> <p>那服务器进程对客户端进程发送的请求做了什么处理，才能产生最后的处理结果呢？这里以查询请求为例展示：
<img src="https://obs-knowledge.oss-cn-beijing.aliyuncs.com/img/20231027140737.png" alt="image.png"></p> <p>下面具体展开看一下（数字标号展示了5.7查询的顺序）：
<img src="https://obs-knowledge.oss-cn-beijing.aliyuncs.com/img/20231027140801.png" alt="image.png"></p> <p><strong>Connectors:</strong> MySQL服务器之外的客户端程序，和具体编程语言相关的内容
<strong>Management Service &amp;Utilities–&gt;基础服务组件：</strong> MySQL服务器的基础服务组件
<strong>Connection Pool --&gt;连接池</strong>： 提供了多个用于客户端和服务器端进行交互的线程，这些线程使用完后交还到<a href="https://so.csdn.net/so/search?q=%E8%BF%9E%E6%8E%A5%E6%B1%A0&amp;spm=1001.2101.3001.7020" target="_blank" rel="noopener noreferrer">连接池<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，供其他客户端使用，从而保证资源不被浪费
<strong>SQL Interface–&gt;SQL接口</strong>： 作用是用来接收SQL指令并返回查询结果
<strong>Parser–&gt;解析器</strong>： 用来解析SQL接口中的SQL，分为语法解析和语义解析。解析后会生成一个语法树，该语法树可用于后续的查询优化。解析器将SQL语句“肢解”为关键字、表名、字段名等内容
<strong>Optimlzer–&gt;优化器：</strong> 核心组件，对SQL进行优化：分为逻辑上的优化和物理上的优化。物理优化—使用索引
<strong>Cache &amp; Buffers–&gt;查询缓存:</strong> 在8.0中已经弃用。以key - value的方式缓存查询结果，查询结果作为value，SQL语句作为key。当下一次查询和缓存的查询语句完全一致时查询命中
<strong>pluggable Storage Engines–&gt;插件式存储引擎：</strong> 与底层的文件系统进行交互
<strong>File system–&gt;文件系统</strong> <strong>File &amp; Logs–&gt;日志文件</strong></p> <p><strong>5.7查询顺序：</strong> Connectors–&gt;Connection Pool (连接池)–&gt;SQL Interface(SQL接口)–&gt;Cache &amp; Buffers(查询缓存)–&gt;Parser(解析器)–&gt;Optimlzer(优化器)–&gt;pluggable Storage Engines(插件式<a href="https://so.csdn.net/so/search?q=%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E&amp;spm=1001.2101.3001.7020" target="_blank" rel="noopener noreferrer">存储引擎<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>)–&gt;File system(文件系统)–&gt;Cache &amp; Buffers(查询缓存)–&gt;SQL Interface(SQL接口)</p> <p><img src="https://obs-knowledge.oss-cn-beijing.aliyuncs.com/img/sql%E6%89%A7%E8%A1%8C%E6%B5%81%E7%A8%8B.jpg" alt="sql执行流程.jpg"></p> <p><img src="https://obs-knowledge.oss-cn-beijing.aliyuncs.com/img/20231027140822.png" alt="image.png"></p> <h3 id="q-mysql的架构是怎样的"><a href="#q-mysql的架构是怎样的" class="header-anchor">#</a> q: mysql的架构是怎样的？</h3> <p>接下来的MysQL Server结构可以分为<strong>如下的三层:</strong>
一、连接层
二、服务层
三、引擎层</p> <h4 id="连接层"><a href="#连接层" class="header-anchor">#</a> 连接层</h4> <p>系统（客户端）访问 MySQL 服务器前，做的第一件事就是建立 TCP 连接。
经过三次握手建立连接成功后， MySQL 服务器对 TCP 传输过来的账号密码做身份认证、权限获取。</p> <ul><li>用户名或密码不对，会收到一个Access denied for user错误，客户端程序结束执行</li> <li>用户名密码认证通过，会从权限表查出账号拥有的权限与连接关联，之后的权限判断逻辑，都将依赖于此时读到的权限</li></ul> <p>TCP 连接收到请求后，必须要分配给一个线程专门与这个客户端的交互。所以还会有个线程池，去走后面的流程。每一个连接从线程池中获取线程，省去了创建和销毁线程的开销。</p> <p><img src="https://obs-knowledge.oss-cn-beijing.aliyuncs.com/img/image-20220615142301226.png" alt="image-20220615142301226.png"></p> <h4 id="服务层"><a href="#服务层" class="header-anchor">#</a> 服务层</h4> <p>SQL Interface: SQL接口</p> <ul><li>接收用户的SQL命令，并且返回用户需要查询的结果。比如SELECT … FROM就是调用SQL Interface</li> <li>MySQL支持DML（数据操作语言）、DDL（数据定义语言）、存储过程、视图、触发器、自定义函数等多种SQL语言接口</li></ul> <p>Parser: 解析器</p> <ul><li>在解析器中对 SQL 语句进行<a href="https://so.csdn.net/so/search?q=%E8%AF%AD%E6%B3%95%E5%88%86%E6%9E%90&amp;spm=1001.2101.3001.7020" target="_blank" rel="noopener noreferrer">语法分析<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>、语义分析。将SQL语句分解成数据结构，并将这个结构传递到后续步骤，以后SQL语句的传递和处理就是基于这个结构的。如果在分解构成中遇到错误，那么就说明这个SQL语句是不合理的。</li> <li>在SQL命令传递到解析器的时候会被解析器验证和解析，并为其创建语法树 ，并根据数据字典丰富查询语法树，会验证该客户端是否具有执行该查询的权限。创建好语法树后，MySQL还会对SQl查询进行语法上的优化，进行查询重写。</li></ul> <p>Optimizer: 查询优化器</p> <ul><li>SQL语句在语法解析之后、查询之前会使用查询优化器确定 SQL 语句的执行路径，生成一个执行计划。</li> <li>这个执行计划表明应该使用哪些索引进行查询（全表检索还是使用索引检索），表之间的连接顺序如何，最后会按照执行计划中的步骤调用存储引擎提供的方法来真正的执行查询，并将查询结果返回给用户。</li> <li>它使用“ 选取-投影-连接 ”策略进行查询。例如：</li></ul> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SELECT</span> id<span class="token punctuation">,</span>name <span class="token keyword">FROM</span> student <span class="token keyword">WHERE</span> gender <span class="token operator">=</span> <span class="token string">'女'</span><span class="token punctuation">;</span>
<span class="token number">1</span>
</code></pre></div><blockquote><p>这个SELECT查询先根据WHERE语句进行 选取 ，而不是将表全部查询出来以后再进行gender过滤。 这个SELECT查询先根据id和name进行属性投影 ，而不是将属性全部取出以后再进行过滤，将这两个查询条件 连接 起来生成最终查询结果。</p></blockquote> <p>Caches &amp; Buffers： 查询缓存组件</p> <ul><li>MySQL内部维持着一些Cache和Buffer，比如Query Cache用来缓存一条SELECT语句的执行结果，如果能够在其中找到对应的查询结果，那么就不必再进行查询解析、优化和执行的整个过 程了，直接将结果反馈给客户端。</li> <li>这个缓存机制是由一系列小缓存组成的。比如表缓存，记录缓存，key缓存，权限缓存等 。</li> <li>这个查询缓存可以在不同客户端之间共享 。</li> <li>从MySQL 5.7.20开始，不推荐使用查询缓存，并在 MySQL 8.0中删除 。</li></ul> <h4 id="引擎层"><a href="#引擎层" class="header-anchor">#</a> 引擎层</h4> <p>插件式存储引擎层（ Storage Engines），真正的负责了MySQL中数据的存储和提取，对物理服务器级别维护的底层数据执行操作， 服务器通过API与存储引擎进行通信。不同的存储引擎具有的功能不同，这样我们可以根据自己的实际需要进行选取。
MySQL 8.0.25默认支持的存储引擎如下：
<img src="https://obs-knowledge.oss-cn-beijing.aliyuncs.com/img/20231027140852.png" alt="image.png"></p> <h3 id="q-为什么要有数据库缓冲池-buffer-pool"><a href="#q-为什么要有数据库缓冲池-buffer-pool" class="header-anchor">#</a> q: 为什么要有数据库缓冲池(buffer pool)？</h3> <p>InnoDB 存储引擎是以页为单位来管理存储空间的，我们进行的增删改查操作其实本质上都是在访问页面（包括读页面、写页面、创建新页面等操作）。而磁盘 I/O 需要消耗的时间很多，而在内存中进行操作，效率则会高很多，为了能让数据表或者索引中的数据随时被我们所用，DBMS 会申请 占用内存来作为数据缓冲池 ，在真正访问页面之前，需要把在磁盘上的页缓存到内存中的 Buffer Pool 之后才可以访问。
这样做的好处是可以让磁盘活动最小化，从而<strong>减少与磁盘直接进行 I/O 的时间</strong> 。要知道，这种策略对提升 SQL 语句的查询性能来说至关重要。如果索引的数据在缓冲池里，那么访问的成本就会降低很多。</p> <blockquote><p>缓冲池和查询缓存是一个东西吗？不是。</p></blockquote> <p>首先我们需要了解在 InnoDB 存储引擎中，缓冲池都包括了哪些。
在 InnoDB 存储引擎中有一部分数据会放到内存中，缓冲池则占了这部分内存的大部分，它用来存储各种数据的缓存，如下图所示：
<img src="https://obs-knowledge.oss-cn-beijing.aliyuncs.com/img/20231027140908.png" alt="image.png"></p> <p>从图中，你能看到 InnoDB 缓冲池包括了数据页、索引页、插入缓冲、锁信息、自适应 Hash 和数据字典信息等。
<strong>缓存池的重要性：</strong>
对于使用InnoDB作为存储引擎的表来说，不管是用于存储用户数据的索引(包括聚簇索引和二级索引)，还是各种系统数据，都是以页的形式存放在表空间中的，而所谓的表空间只不过是InnoDB对文件系统上一个或几个实际文件的抽象，也就是说我们的数据说到底还是存储在磁盘上的。但是各位也都知道，磁盘的速度慢的跟乌龟一样，怎么能配得上&quot;快如风，疾如电&quot;的CPU呢?这里，缓冲池可以帮助我们消除CPU和磁盘之间的鸿沟。所以InnoDB存储引擎在处理客户端的请求时，当需要访问某个页的数据时，就会把完整的页的数据全部加载到内存中,也就是说即使我们只需要访问一个页的一条记录，那也需要先把整个页的数据加载到内存中。将整个页加载到内存中后就可以进行读写访问了，在进行完读写访问之后并不着急把该页对应的内存空间释放掉，而是将其缓存起来，这样将来有请求再次访问该页面时，就可以省去磁盘IO的开销了。</p> <p><strong>缓存原则：</strong>
“ 位置 * 频次 ”这个原则，可以帮我们对 I/O 访问效率进行优化。
首先，位置决定效率，提供缓冲池就是为了在内存中可以直接访问数据。
其次，频次决定优先级顺序。因为缓冲池的大小是有限的，比如磁盘有 200G，但是内存只有 16G，缓冲池大小只有 1G，就无法将所有数据都加载到缓冲池里，这时就涉及到优先级顺序，会 优先对使用频次高的热数据进行加载 。
<strong>缓冲池的预读特性：</strong>
了解了缓冲池的作用之后，我们还需要了解缓冲池的另一个特性:预读。
缓冲池的作用就是提升IO效率，而我们进行读取数据的时候存在一个&quot;“局部性原理”，也就是说我们使用了一些数据，大概率还会使用它周周的一些数据，因此采用“预读”的机制提前加载，可以减少未来可能的磁盘I/O操作。</p> <h2 id="q-mysql都有哪些引擎"><a href="#q-mysql都有哪些引擎" class="header-anchor">#</a> q: MySQL都有哪些引擎？</h2> <p><strong>InnoDB</strong></p> <p>InnoDB 是一种兼顾高可靠性和高性能的通用存储引擎，在 MySQL 5.5 之后，InnoDB 是默认的 MySQL 引擎。</p> <p>特点：</p> <ul><li>DML 操作遵循 ACID 模型，支持<strong>事务</strong></li> <li><strong>行级锁</strong>，提高并发访问性能</li> <li>支持<strong>外键</strong>约束，保证数据的完整性和正确性</li></ul> <p>文件：</p> <ul><li>xxx.ibd: xxx代表表名，InnoDB 引擎的每张表都会对应这样一个表空间文件，存储该表的表结构（frm、sdi）、数据和索引。</li></ul> <p><strong>MyISAM</strong></p> <p>MyISAM 是 MySQL 早期的默认存储引擎。</p> <p>特点：</p> <ul><li>不支持事务，不支持外键</li> <li>支持表锁，不支持行锁</li> <li>访问速度快</li></ul> <p>文件：</p> <ul><li>xxx.sdi: 存储表结构信息</li> <li>xxx.MYD: 存储数据</li> <li>xxx.MYI: 存储索引</li></ul> <p><strong>Memory</strong></p> <p>Memory 引擎的表数据是存储在内存中的，受硬件问题、断电问题的影响，只能将这些表作为临时表或缓存使用。</p> <p>特点：</p> <ul><li>存放在内存中，速度快</li> <li>hash索引（默认）</li></ul> <p>文件：</p> <ul><li>xxx.sdi: 存储表结构信息</li></ul> <p>存储引擎特点</p> <table><thead><tr><th>特点</th> <th>InnoDB</th> <th>MyISAM</th> <th>Memory</th></tr></thead> <tbody><tr><td>存储限制</td> <td>64TB</td> <td>有</td> <td>有</td></tr> <tr><td>事务安全</td> <td>支持</td> <td>-</td> <td>-</td></tr> <tr><td>锁机制</td> <td>行锁</td> <td>表锁</td> <td>表锁</td></tr> <tr><td>B+tree索引</td> <td>支持</td> <td>支持</td> <td>支持</td></tr> <tr><td>Hash索引</td> <td>-</td> <td>-</td> <td>支持</td></tr> <tr><td>全文索引</td> <td>支持（5.6版本之后）</td> <td>支持</td> <td>-</td></tr> <tr><td>空间使用</td> <td>高</td> <td>低</td> <td>N/A</td></tr> <tr><td>内存使用</td> <td>高</td> <td>低</td> <td>中等</td></tr> <tr><td>批量插入速度</td> <td>低</td> <td>高</td> <td>高</td></tr> <tr><td>支持外键</td> <td>支持</td> <td>-</td> <td>-</td></tr></tbody></table> <p>存储引擎的选择</p> <p>在选择存储引擎时，应该根据应用系统的特点选择合适的存储引擎。对于复杂的应用系统，还可以根据实际情况选择多种存储引擎进行组合。</p> <ul><li>InnoDB: 如果应用对事物的完整性有比较高的要求，在并发条件下要求数据的一致性，数据操作除了插入和查询之外，还包含很多的更新、删除操作，则 InnoDB 是比较合适的选择</li> <li>MyISAM: 如果应用是以读操作和插入操作为主，只有很少的更新和删除操作，并且对事务的完整性、并发性要求不高，那这个存储引擎是非常合适的。</li> <li>Memory: 将所有数据保存在内存中，访问速度快，通常用于临时表及缓存。Memory 的缺陷是对表的大小有限制，太大的表无法缓存在内存中，而且无法保障数据的安全性</li></ul> <p>eg.电商中的足迹和评论适合使用 MyISAM 引擎，缓存适合使用 Memory 引擎。</p> <h2 id="q-innodb存储引擎的特点"><a href="#q-innodb存储引擎的特点" class="header-anchor">#</a> q: innodb存储引擎的特点</h2> <ul><li>InnoDB 引擎具备==外键==支持功能的事务存储引擎（InnoDB的优点一）</li> <li>MySQL从3.23.34a开始就包含InnoDB存储引擎。 大于等于5.5之后，==默认==采用InnoDB引擎 。</li> <li>InnoDB是MySQL的<strong>默认==事务==型引擎</strong>，它被设计用来处理大量的短期(short-lived)事务。可以确保事务的完整提交(Commit)和回滚(Rollback)（InnoDB的优点二）</li> <li>除了增加和查询外（MyISAM擅长增加和查询）,还需要更新、删除操作，那么，应优先选择InnoDB存储引擎。</li> <li><strong>除非有非常特别的原因需要使用其他的存储引擎，否则应该优先考虑InnoDB引擎。</strong></li> <li>数据文件结构：（在《第02章_MySQL数据目录》章节已讲）
表名.frm 存储表结构（MySQL8.0时，合并在表名.ibd中）
表名.ibd 存储数据和索引</li> <li>InnoDB是 为处理巨大数据量的最大性能而设计 （InnoDB的优点三）</li> <li>在以前的版本中，字典数据以元数据文件、非事务表等来存储。现在这些元数据文件被删除了。比如： .frm ， .par ， .trn ，.isl ， .db.opt 等都在MySQL8.0中不存在了。</li> <li>对于并发量大的情况和数据量大的情况，InnoDB性能表现较好。InnoDB支持行级锁，行级锁粒度低，更适合于高并发的场景（InnoDB的优点四）
<strong>InnoDB的缺点：</strong></li> <li>对比MyISAM的存储引擎， InnoDB写的处理效率差一些 ，并且会占用更多的磁盘空间以保存数据和索引（InnoDB缺点）。</li> <li>MyISAM只缓存索引，不缓存真实数据；InnoDB不仅缓存索引还要缓存真实数据， 对内存要求较高 ，而且内存大小对性能有决定性的影响。</li></ul></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/cs/计算机基础/数据库/面试题/基础/sql.html" class="prev">
        sql
      </a></span> <span class="next"><a href="/cs/计算机基础/数据库/面试题/索引/索引.html">
        索引
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/cs/assets/js/app.3833f9ea.js" defer></script><script src="/cs/assets/js/2.3dc1b8de.js" defer></script><script src="/cs/assets/js/1.54be531d.js" defer></script><script src="/cs/assets/js/36.f36ea129.js" defer></script>
  </body>
</html>
